<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Patterns — Satiate</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&display=swap" rel="stylesheet" />
  <style>@import url('https://fonts.cdnfonts.com/css/fk-grotesk');</style>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            cream:       '#F9F7F4',
            'cream-2':   '#F2EFE9',
            teal:        '#20B8CD',
            'teal-lt':   '#74E4F2',
            'teal-pale': '#E0F8FB',
            navy:        '#1C2B3A',
            sand:        '#C4A882',
            'sand-lt':   '#EDE4D8',
          },
          fontFamily: {
            display: ['"FK Grotesk"', '"Space Grotesk"', 'sans-serif'],
            body:    ['"DM Sans"', 'Inter', 'sans-serif'],
          },
        }
      }
    }
  </script>

  <style>
    /* ── Reset ── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      background: #F9F7F4;
      font-family: 'DM Sans', Inter, sans-serif;
      color: #1C2B3A;
      overflow-x: hidden;
    }

    /* ── Grain overlay ── */
    body::before {
      content: '';
      position: fixed;
      inset: -50%;
      width: 200%; height: 200%;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
      opacity: 0.045;
      pointer-events: none;
      z-index: 9999;
    }

    /* ── Typography ── */
    .font-display { font-family: 'FK Grotesk', 'Space Grotesk', sans-serif; }
    .section-label {
      font-size: 11px; font-weight: 600; letter-spacing: 0.12em;
      text-transform: uppercase; color: #20B8CD;
    }

    /* ── Navbar ── */
    .nav-glass {
      background: rgba(249,247,244,0.84);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border-bottom: 1px solid rgba(28,43,58,0.06);
    }
    .nav-link {
      font-size: 14px; font-weight: 500; color: rgba(28,43,58,0.55);
      text-decoration: none; transition: color 0.2s ease;
    }
    .nav-link:hover { color: #1C2B3A; }
    .nav-link.active { color: #20B8CD; font-weight: 600; }
    .btn-ghost {
      border: 1.5px solid rgba(28,43,58,0.18); color: #1C2B3A;
      background: transparent; cursor: pointer;
      transition: border-color 0.2s ease, color 0.2s ease, background 0.2s ease;
    }
    .btn-ghost:hover { border-color: #20B8CD; color: #20B8CD; background: rgba(32,184,205,0.04); }

    /* ── Page layout ── */
    .patterns-main { padding-top: 64px; }

    /* ── Section wrapper ── */
    .pt-section {
      padding: 64px 0;
      position: relative;
      overflow: hidden;
    }
    .pt-section:nth-child(2) { background: #F2EFE9; }
    .pt-section:nth-child(3) { background: #F9F7F4; }
    @media (max-width: 768px) { .pt-section { padding: 32px 0; } }

    .pt-inner { max-width: 1100px; margin: 0 auto; padding: 0 24px; }

    /* ── Section header ── */
    .pt-section-head { margin-bottom: 36px; }
    .pt-section-head h2 {
      font-family: 'FK Grotesk', 'Space Grotesk', sans-serif;
      font-size: clamp(28px, 3.2vw, 40px);
      font-weight: 700; letter-spacing: -0.04em; color: #1C2B3A; line-height: 1.1;
      margin-top: 10px;
    }

    /* ── Reveal animation ── */
    .reveal {
      opacity: 0; transform: translateY(20px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }
    .reveal.visible { opacity: 1; transform: translateY(0); }

    /* ══════════════════════════════════════════════
       ZONE 1 — WEEKLY HEATMAP
    ══════════════════════════════════════════════ */
    #weekly-grid {
      display: grid;
      grid-template-columns: 90px repeat(7, 1fr);
      gap: 5px;
    }
    .wg-header-row {
      display: contents;
    }
    .wg-row {
      display: contents;
    }
    .wg-day-header {
      display: flex; flex-direction: column; align-items: center;
      font-family: 'FK Grotesk', 'Space Grotesk', sans-serif;
      font-size: 12px; font-weight: 600; color: rgba(28,43,58,0.55);
      padding-bottom: 4px; letter-spacing: 0.02em;
    }
    .wg-date-sub {
      font-size: 11px; font-weight: 400; color: rgba(28,43,58,0.35); margin-top: 1px;
    }
    .wg-band-label {
      font-size: 11px; font-weight: 500; color: rgba(28,43,58,0.45);
      display: flex; align-items: center; padding-right: 8px; letter-spacing: 0.02em;
    }
    /* First band label in header is empty spacer */
    .wg-header-row .wg-band-label { padding-bottom: 4px; }

    .wg-cell {
      position: relative;
      border-radius: 8px;
      height: 62px;
      border: 1px solid transparent;
      display: flex; align-items: center; justify-content: center;
      overflow: visible;
      transition: opacity 0.2s;
      cursor: default;
    }
    .wg-cell.has-tooltip { cursor: pointer; }
    .wg-cell.has-tooltip:hover { opacity: 0.85; }

    .wg-cell-score {
      font-family: 'FK Grotesk', 'Space Grotesk', sans-serif;
      font-size: 15px; font-weight: 700; letter-spacing: -0.03em;
    }

    /* Craving dot */
    .wg-craving-dot {
      position: absolute; top: 6px; right: 7px;
      width: 7px; height: 7px; border-radius: 50%;
      background: #E05C5C;
      box-shadow: 0 0 4px rgba(224,92,92,0.55);
    }

    /* Tooltip */
    .wg-tooltip {
      display: none;
      position: absolute;
      bottom: calc(100% + 8px);
      left: 50%; transform: translateX(-50%);
      min-width: 200px; max-width: 260px;
      background: rgba(255,255,255,0.97);
      border: 1px solid rgba(28,43,58,0.09);
      border-radius: 12px;
      padding: 10px 12px;
      box-shadow: 0 8px 32px rgba(28,43,58,0.12);
      z-index: 100;
      pointer-events: none;
    }
    .wg-cell.has-tooltip:hover .wg-tooltip { display: block; }
    .wg-tip-meal {
      display: flex; align-items: center; justify-content: space-between; gap: 8px;
      margin-bottom: 2px;
    }
    .wg-tip-name {
      font-size: 12px; font-weight: 500; color: #1C2B3A;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1;
    }
    .wg-tip-pill {
      font-size: 10px; font-weight: 600; border-radius: 20px; padding: 1px 7px;
      flex-shrink: 0;
    }
    .wg-tip-cal {
      font-size: 11px; color: rgba(28,43,58,0.42); margin-bottom: 6px;
    }
    .wg-tip-hr {
      border: none; border-top: 1px solid rgba(28,43,58,0.06); margin: 6px 0;
    }

    /* Weekly summary */
    #weekly-summary {
      margin-top: 20px;
      font-size: 14px; line-height: 1.6; color: rgba(28,43,58,0.58);
      padding: 14px 18px;
      background: rgba(32,184,205,0.06);
      border: 1px solid rgba(32,184,205,0.16);
      border-radius: 12px;
    }

    /* Mobile: horizontal scroll */
    @media (max-width: 680px) {
      .wg-scroll-wrap {
        overflow-x: auto;
        padding-bottom: 8px;
        -webkit-overflow-scrolling: touch;
      }
      #weekly-grid {
        min-width: 560px;
      }
    }

    /* ══════════════════════════════════════════════
       ZONE 2 — MONTHLY CALENDAR
    ══════════════════════════════════════════════ */
    .cal-container {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 24px;
      align-items: start;
    }
    @media (max-width: 900px) {
      .cal-container { grid-template-columns: 1fr; }
    }

    /* Day-of-week header */
    .cal-header {
      display: grid; grid-template-columns: repeat(7, 1fr);
      margin-bottom: 6px;
    }
    .cal-dow {
      text-align: center; font-size: 11px; font-weight: 600;
      color: rgba(28,43,58,0.40); letter-spacing: 0.06em; padding: 4px 0;
    }

    /* Grid */
    #cal-grid {
      display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px;
    }

    .cal-cell {
      aspect-ratio: 1 / 1;
      border-radius: 10px;
      border: 1px solid rgba(28,43,58,0.06);
      background: rgba(255,255,255,0.55);
      display: flex; flex-direction: column;
      padding: 6px 7px 5px;
      position: relative;
      overflow: hidden;
      cursor: default;
      transition: opacity 0.2s;
    }
    .cal-cell.cal-has-meals {
      cursor: pointer;
    }
    .cal-cell.cal-has-meals:hover {
      opacity: 0.8;
      border-color: rgba(32,184,205,0.3);
    }
    .cal-cell.cal-empty {
      background: transparent; border-color: transparent;
    }
    .cal-cell.cal-weekend {
      background: rgba(0,0,0,0.015);
    }
    .cal-cell.cal-today {
      border: 2px solid #20B8CD !important;
      box-shadow: 0 0 0 3px rgba(32,184,205,0.12);
    }

    .cal-day-num {
      font-family: 'FK Grotesk', 'Space Grotesk', sans-serif;
      font-size: 13px; font-weight: 600; color: rgba(28,43,58,0.7);
      line-height: 1;
    }
    .cal-today .cal-day-num { color: #20B8CD; }

    .cal-craving-badge {
      position: absolute; top: 4px; right: 5px;
      font-size: 9px; color: #E8A838;
    }

    .cal-dots {
      display: flex; align-items: center; gap: 3px;
      margin-top: auto; padding-top: 4px; flex-wrap: wrap;
    }
    .cal-dot {
      width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0;
    }
    .cal-more {
      font-size: 9px; color: rgba(28,43,58,0.40); font-weight: 500;
    }

    /* Day Panel (slide-in from right) */
    #day-panel-overlay {
      position: fixed; inset: 0; background: rgba(28,43,58,0.18);
      backdrop-filter: blur(2px);
      z-index: 200; opacity: 0; pointer-events: none;
      transition: opacity 0.3s ease;
    }
    #day-panel-overlay.open { opacity: 1; pointer-events: auto; }

    #day-panel {
      position: fixed; top: 0; right: 0; height: 100%;
      width: min(400px, 100vw);
      background: rgba(249,247,244,0.98);
      border-left: 1px solid rgba(28,43,58,0.08);
      box-shadow: -12px 0 48px rgba(28,43,58,0.12);
      z-index: 201;
      transform: translateX(100%);
      transition: transform 0.38s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex; flex-direction: column;
      overflow: hidden;
    }
    #day-panel.open { transform: translateX(0); }

    .dp-header {
      padding: 20px 20px 16px;
      border-bottom: 1px solid rgba(28,43,58,0.07);
      display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;
      flex-shrink: 0;
    }
    #dp-title {
      font-family: 'FK Grotesk', 'Space Grotesk', sans-serif;
      font-size: 17px; font-weight: 700; color: #1C2B3A; letter-spacing: -0.02em;
      line-height: 1.2;
    }
    #day-panel-close {
      background: rgba(28,43,58,0.07); border: none; border-radius: 50%;
      width: 30px; height: 30px; cursor: pointer; flex-shrink: 0;
      font-size: 16px; color: rgba(28,43,58,0.5); display: flex;
      align-items: center; justify-content: center;
      transition: background 0.2s ease;
    }
    #day-panel-close:hover { background: rgba(28,43,58,0.12); }

    #dp-macro-bar { padding: 14px 20px; border-bottom: 1px solid rgba(28,43,58,0.06); flex-shrink: 0; }
    .dp-macro-summary {
      display: flex; gap: 14px; flex-wrap: wrap;
      font-size: 12px; font-weight: 500; color: rgba(28,43,58,0.55);
      margin-bottom: 8px;
    }
    .dp-macro-track {
      height: 8px; border-radius: 4px; background: rgba(28,43,58,0.06);
      display: flex; overflow: hidden;
    }

    #dp-meal-list {
      flex: 1; overflow-y: auto; padding: 12px 20px 20px;
      scrollbar-width: thin; scrollbar-color: rgba(28,43,58,0.1) transparent;
    }
    .dp-meal {
      display: flex; gap: 0; border-radius: 14px; overflow: hidden;
      background: rgba(255,255,255,0.7); border: 1px solid rgba(28,43,58,0.06);
      margin-bottom: 8px; box-shadow: 0 2px 10px rgba(28,43,58,0.04);
    }
    .dp-meal-accent { width: 3px; flex-shrink: 0; }
    .dp-meal-body { flex: 1; padding: 11px 13px; }
    .dp-meal-top {
      display: flex; align-items: center; justify-content: space-between;
      gap: 8px; margin-bottom: 4px;
    }
    .dp-meal-name {
      font-family: 'FK Grotesk', 'Space Grotesk', sans-serif;
      font-size: 13px; font-weight: 600; color: #1C2B3A; letter-spacing: -0.01em;
    }
    .dp-meal-pill {
      font-size: 10px; font-weight: 600; border-radius: 20px; padding: 2px 8px; flex-shrink: 0;
    }
    .dp-meal-meta { font-size: 11px; color: rgba(28,43,58,0.42); }
    .dp-craving-flag {
      color: #E05C5C; font-weight: 600;
    }

    /* ══════════════════════════════════════════════
       ZONE 3 — PATTERN INSIGHTS
    ══════════════════════════════════════════════ */
    #insights-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 18px;
    }
    @media (max-width: 640px) {
      #insights-grid { grid-template-columns: 1fr; }
    }

    .insight-card {
      display: flex;
      background: rgba(255,255,255,0.62);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(28,43,58,0.06);
      border-radius: 20px;
      box-shadow: 0 4px 24px rgba(32,184,205,0.07);
      overflow: hidden;
    }
    .insight-accent {
      width: 4px; flex-shrink: 0;
      background: linear-gradient(180deg, #20B8CD 0%, #74E4F2 100%);
    }
    .insight-body {
      padding: 22px 22px 22px 20px; flex: 1;
    }
    .insight-icon-wrap {
      width: 40px; height: 40px; border-radius: 12px;
      background: rgba(32,184,205,0.10);
      border: 1.5px solid rgba(32,184,205,0.20);
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 14px;
    }
    .insight-type {
      font-size: 10px; font-weight: 700; letter-spacing: 0.12em;
      text-transform: uppercase; color: rgba(28,43,58,0.38);
      margin-bottom: 6px;
    }
    .insight-stat {
      font-family: 'FK Grotesk', 'Space Grotesk', sans-serif;
      font-size: 32px; font-weight: 700; letter-spacing: -0.04em;
      color: #1C2B3A; line-height: 1; margin-bottom: 10px;
    }
    .insight-text {
      font-size: 13px; line-height: 1.68; color: rgba(28,43,58,0.58);
    }

    /* ── Legend ── */
    .tier-legend {
      display: flex; align-items: center; gap: 18px; flex-wrap: wrap;
      margin-bottom: 18px;
    }
    .legend-item {
      display: flex; align-items: center; gap: 6px;
      font-size: 12px; color: rgba(28,43,58,0.55);
    }
    .legend-dot {
      width: 10px; height: 10px; border-radius: 3px; flex-shrink: 0;
    }
    .legend-craving {
      display: flex; align-items: center; gap: 5px;
      font-size: 12px; color: rgba(28,43,58,0.55);
    }
    .legend-craving-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: #E05C5C; flex-shrink: 0;
    }
  </style>
</head>
<body>

<!-- ══════════════════════════════════════
     NAVBAR
══════════════════════════════════════ -->
<nav class="nav-glass fixed top-0 left-0 right-0 z-50">
  <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">

    <!-- Logo -->
    <a href="/" class="flex items-center gap-2.5 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-teal rounded-xl">
      <div class="w-9 h-9 rounded-xl overflow-hidden flex-shrink-0" style="box-shadow:0 2px 10px rgba(28,43,58,0.18);">
        <img src="brand_assets/logos/logo5.png" alt="Satiate" class="w-full h-full object-cover" />
      </div>
      <span class="font-display font-semibold text-xl" style="color:#1C2B3A; letter-spacing:-0.035em;">satiate</span>
    </a>

    <!-- Center nav -->
    <div class="hidden md:flex items-center gap-7">
      <a href="/dashboard.html" class="nav-link">Dashboard</a>
      <a href="/patterns.html"  class="nav-link active">Patterns</a>
    </div>

    <!-- Right: avatar + sign out -->
    <div class="flex items-center gap-3">
      <img id="user-avatar" src="" alt="avatar"
        class="w-8 h-8 rounded-full object-cover flex-shrink-0"
        style="border:2px solid rgba(32,184,205,0.28); background:#E0F8FB;" />
      <button id="signout-btn"
        class="btn-ghost font-display font-medium px-4 py-2 rounded-full"
        style="font-size:13px; letter-spacing:-0.01em;">
        Sign Out
      </button>
    </div>
  </div>
</nav>


<!-- ══════════════════════════════════════
     MAIN
══════════════════════════════════════ -->
<main class="patterns-main">

  <!-- ══ ZONE 1: WEEKLY VIEW ══════════════════════════════════════ -->
  <section class="pt-section">
    <!-- Subtle bloom -->
    <div class="absolute inset-0 pointer-events-none" style="background:radial-gradient(ellipse at 80% 30%, rgba(32,184,205,0.06) 0%, transparent 60%);"></div>

    <div class="pt-inner">
      <div class="pt-section-head reveal">
        <div class="section-label">This Week</div>
        <h2>Weekly heatmap</h2>
        <p style="font-size:15px; line-height:1.7; color:rgba(28,43,58,0.52); margin-top:8px; max-width:520px;">
          Satiety scores by time of day, Feb 16–22. Craving occurrences marked in red.
        </p>
      </div>

      <!-- Legend -->
      <div class="tier-legend reveal">
        <div class="legend-item">
          <div class="legend-dot" style="background:rgba(32,184,205,0.55);"></div>
          <span>High satiety ≥65%</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background:rgba(232,168,56,0.55);"></div>
          <span>Mid 35–64%</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background:rgba(224,92,92,0.55);"></div>
          <span>Low &lt;35%</span>
        </div>
        <div class="legend-craving">
          <div class="legend-craving-dot"></div>
          <span>Craving logged</span>
        </div>
      </div>

      <!-- Grid (horizontal scroll on mobile) -->
      <div class="wg-scroll-wrap reveal">
        <div id="weekly-grid"></div>
      </div>

      <!-- Auto-summary -->
      <div id="weekly-summary" class="reveal"></div>
    </div>
  </section>


  <!-- ══ ZONE 2: MONTHLY CALENDAR ═════════════════════════════════ -->
  <section class="pt-section">
    <div class="absolute inset-0 pointer-events-none" style="background:radial-gradient(ellipse at 20% 60%, rgba(196,168,130,0.07) 0%, transparent 55%);"></div>

    <div class="pt-inner">
      <div class="pt-section-head reveal">
        <div class="section-label">February 2026</div>
        <h2>Monthly overview</h2>
        <p style="font-size:15px; line-height:1.7; color:rgba(28,43,58,0.52); margin-top:8px; max-width:520px;">
          Meal logs and craving spikes across the month. Tap any date to see the full breakdown.
        </p>
      </div>

      <div class="cal-container reveal">
        <!-- Calendar -->
        <div>
          <!-- Day-of-week header -->
          <div class="cal-header">
            <div class="cal-dow">Mon</div>
            <div class="cal-dow">Tue</div>
            <div class="cal-dow">Wed</div>
            <div class="cal-dow">Thu</div>
            <div class="cal-dow">Fri</div>
            <div class="cal-dow">Sat</div>
            <div class="cal-dow">Sun</div>
          </div>
          <!-- Calendar grid (populated by patterns.js) -->
          <div id="cal-grid"></div>

          <!-- Calendar legend -->
          <div class="tier-legend" style="margin-top:16px;">
            <div class="legend-item">
              <div class="legend-dot" style="background:#20B8CD; border-radius:50%;"></div>
              <span>High satiety meal</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot" style="background:#E8A838; border-radius:50%;"></div>
              <span>Mid satiety meal</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot" style="background:#E05C5C; border-radius:50%;"></div>
              <span>Low satiety meal</span>
            </div>
            <div class="legend-item" style="gap:4px;">
              <span style="font-size:13px; color:#E8A838;">⚠</span>
              <span>Craving day</span>
            </div>
          </div>
        </div>

        <!-- Side info card -->
        <div class="reveal" style="align-self:start;">
          <div style="background:rgba(255,255,255,0.62); backdrop-filter:blur(10px); border:1px solid rgba(28,43,58,0.06); border-radius:20px; box-shadow:0 4px 24px rgba(32,184,205,0.07); padding:24px;">
            <div class="section-label" style="margin-bottom:14px;">February at a glance</div>
            <div id="cal-stats" style="display:flex; flex-direction:column; gap:14px;">
              <!-- Populated by inline script below -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>


  <!-- ══ ZONE 3: PATTERN INSIGHTS ═════════════════════════════════ -->
  <section class="pt-section">
    <div class="absolute inset-0 pointer-events-none" style="background:radial-gradient(ellipse at 60% 40%, rgba(32,184,205,0.055) 0%, transparent 58%);"></div>

    <div class="pt-inner">
      <div class="pt-section-head reveal">
        <div class="section-label">Auto-generated</div>
        <h2>Pattern insights</h2>
        <p style="font-size:15px; line-height:1.7; color:rgba(28,43,58,0.52); margin-top:8px; max-width:520px;">
          Patterns computed from your last 30 days. No AI — just your data, clearly analysed.
        </p>
      </div>

      <div id="insights-grid" class="reveal"></div>
    </div>
  </section>

</main>


<!-- Day Panel Overlay -->
<div id="day-panel-overlay"></div>

<!-- Day Panel -->
<div id="day-panel">
  <div class="dp-header">
    <div id="dp-title">—</div>
    <button id="day-panel-close" aria-label="Close">✕</button>
  </div>
  <div id="dp-macro-bar"></div>
  <div id="dp-meal-list"></div>
</div>


<!-- STEP6 ANCHOR -->

<script>
  window.ENV = {
    SUPABASE_URL: 'https://wltqzakjhlwtyjgwbcfu.supabase.co',
    SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndsdHF6YWtqaGx3dHlqZ3diY2Z1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2ODUwNTQsImV4cCI6MjA4NzI2MTA1NH0.fanBBsr4h4nCsmWkDguS9eLWaXyB0feo7OOtuu3tYqE',
  };
</script>

<script type="module">
  import { getUser, signOut } from './js/auth.js';
  import { init }             from './js/patterns.js';
  import { MEAL_HISTORY }     from './js/patterns-data.js';

  // Auth guard
  const user = await getUser();
  if (!user) {
    window.location.replace('/?auth_required=true');
  } else {
    const avatar = document.getElementById('user-avatar');
    if (user.user_metadata?.avatar_url) avatar.src = user.user_metadata.avatar_url;
    document.getElementById('signout-btn').addEventListener('click', signOut);
  }

  // Render all zones
  init();

  // Populate "February at a glance" sidebar stats
  const febMeals = MEAL_HISTORY.filter(m => m.date.startsWith('2026-02'));
  const febDays  = [...new Set(febMeals.map(m => m.date))].length;
  const cravings = febMeals.filter(m => m.craving).length;
  const avgSat   = febMeals.length ? Math.round(febMeals.reduce((s,m) => s + m.satiety_score, 0) / febMeals.length * 100) : 0;
  const highDays = [...new Set(
    febMeals.filter(m => m.satiety_score >= 0.65).map(m => m.date)
  )].length;

  const stats = [
    { label: 'Meals logged',     value: febMeals.length,           color: '#1C2B3A' },
    { label: 'Days tracked',     value: febDays,                   color: '#1C2B3A' },
    { label: 'Avg satiety',      value: avgSat + '%',              color: '#20B8CD' },
    { label: 'High-satiety days',value: highDays,                  color: '#20B8CD' },
    { label: 'Cravings logged',  value: cravings,                  color: '#E05C5C' },
  ];

  document.getElementById('cal-stats').innerHTML = stats.map(s => `
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
      <span style="font-size:13px;color:rgba(28,43,58,0.55);">${s.label}</span>
      <span style="font-family:'FK Grotesk','Space Grotesk',sans-serif;font-size:20px;font-weight:700;color:${s.color};letter-spacing:-0.03em;">${s.value}</span>
    </div>
    <div style="height:1px;background:rgba(28,43,58,0.05);margin:0 -4px;"></div>
  `).slice(0, -1).join('') + stats.map(() => '').join('');

  // Re-render properly without trailing divider
  document.getElementById('cal-stats').innerHTML = stats.map((s, i) => `
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
      <span style="font-size:13px;color:rgba(28,43,58,0.55);">${s.label}</span>
      <span style="font-family:'FK Grotesk','Space Grotesk',sans-serif;font-size:20px;font-weight:700;color:${s.color};letter-spacing:-0.03em;">${s.value}</span>
    </div>${i < stats.length-1 ? '<div style="height:1px;background:rgba(28,43,58,0.05);"></div>' : ''}
  `).join('');
</script>

</body>
</html>
